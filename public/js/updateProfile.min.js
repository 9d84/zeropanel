function getResult(e,t,o){Swal.fire({title:e,text:t,icon:o,buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-primary"}})}var KTUsersUpdateName=function(){let e=document.getElementById("zero_modal_user_update_name"),t=e.querySelector("#zero_modal_user_update_name_form"),o=new bootstrap.Modal(e);var n=()=>{var n=FormValidation.formValidation(t,{fields:{profile_name:{validators:{notEmpty:{message:"Naem is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let r=e.querySelector('[data-kt-users-modal-action="submit"]');r.addEventListener("click",function(e){e.preventDefault(),n&&n.validate().then(function(e){console.log("validated!"),"Valid"==e&&(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,setTimeout(function(){r.removeAttribute("data-kt-indicator"),r.disabled=!1,$.ajax({type:"POST",url:"/user/update_name",dataType:"json",data:{newusername:$("#profile_name").val()},success:function(e){1==e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&(o.hide(),location.reload())}):getResult(e.msg,"","error")}})},2e3))})})};return{init:function(){n()}}}();KTUtil.onDOMContentLoaded(function(){KTUsersUpdateName.init()});var KTUsersUpdateEmail=function(){let e=document.getElementById("zero_modal_user_update_email"),t=e.querySelector("#zero_modal_user_update_email_form"),o=new bootstrap.Modal(e);var n=()=>{var n=FormValidation.formValidation(t,{fields:{profile_email:{validators:{notEmpty:{message:"Email address is required"},emailAddress:{message:"邮箱格式不正确"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let r=e.querySelector('[data-kt-users-modal-action="submit"]');r.addEventListener("click",function(e){e.preventDefault(),n&&n.validate().then(function(e){console.log("validated!"),"Valid"==e&&(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,setTimeout(function(){r.removeAttribute("data-kt-indicator"),r.disabled=!1,$.ajax({type:"POST",url:"/user/update_email",dataType:"json",data:{newemail:$("#profile_email").val()},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&(o.hide(),location.reload())}):getResult(e.msg,"","error")}})},2e3))})})};return{init:function(){n()}}}();KTUtil.onDOMContentLoaded(function(){KTUsersUpdateEmail.init()});var KTUsersUpdatePassword=function(){let e=document.getElementById("zero_modal_user_update_password"),t=e.querySelector("#zero_modal_user_update_password_form"),o=new bootstrap.Modal(e);var n=()=>{var n=FormValidation.formValidation(t,{fields:{current_password:{validators:{notEmpty:{message:"请输入当前密码"}}},password:{validators:{notEmpty:{message:"请输入新密码"},callback:{message:"请输入有效的密码",callback:function(e){if(e.value.length>0)return validatePassword()}}}},confirm_password:{validators:{notEmpty:{message:"请确认新密码"},identical:{compare:function(){return t.querySelector('[name="new_password"]').value},message:"新密码两次输入不一致"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let r=e.querySelector('[data-kt-users-modal-action="submit"]');r.addEventListener("click",function(e){e.preventDefault(),n&&n.validate().then(function(e){console.log("validated!"),"Valid"==e&&(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,setTimeout(function(){r.removeAttribute("data-kt-indicator"),r.disabled=!1,$.ajax({type:"POST",url:"/user/update_password",dataType:"json",data:{current_password:$("#current_password").val(),new_password:$("#new_password").val()},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&(o.hide(),location.reload())}):getResult(e.msg,"","error")}})},2e3))})})};return{init:function(){n()}}}();function KTUsersEnableNotify(e){if(document.getElementById("notify_email").checked)var t=e;else if(document.getElementById("notify_telegram").checked)var t=e;$.ajax({type:"POST",url:"/user/enable_notify",dataType:"json",data:{notify_type:t},success:function(e){}})}function KTUsersResetPasswd(){$.ajax({type:"POST",url:"/user/reset_passwd",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function KTUsersResetUUID(){$.ajax({type:"POST",url:"/user/reset_uuid",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function KTUsersResetSubLink(){$.ajax({type:"POST",url:"/user/reset_sub_link",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function kTUserConfigureProductModal(e){the_product_id=e;let t=document.getElementById("zero_product_"+e).innerHTML,o=document.getElementById("zero_product_name_"+e).innerHTML,n=document.getElementById("zero_product_price_"+e).innerHTML,r=document.querySelector('[data-kt-users-action="submit"]');document.getElementById("zero_modal_configure_product_inner_html").innerHTML=t,document.getElementById("zero_modal_configure_product_name").innerHTML=o+"&nbsp;X&nbsp;1",document.getElementById("zero_modal_configure_product_price").innerHTML=n+"USD",document.getElementById("zero_modal_configure_product_total").innerHTML=n+"USD",r.setAttribute("onclick",'KTUsersCreateOrder("purchase_product_order",'+e+")"),$("#zero_modal_configure_product").modal("show")}function KTUserVerifyCoupon(){$.ajax({type:"POST",url:"/user/verify_coupon",dataType:"json",data:{coupon_code:$("#zero_coupon_code").val(),product_id:the_product_id},success:function(e){1==e.ret?document.getElementById("zero_modal_configure_product_total").innerHTML=e.total+"USD":getResult(e.msg,"","error")}})}function KTUsersCreateOrder(e,t){let o=document.querySelector('[data-kt-users-action="submit"]');switch(o.setAttribute("data-kt-indicator","on"),o.disabled=!0,e){case"purchase_product_order":setTimeout(function(){$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{product_id:t,coupon_code:$("#zero_coupon_code").val()},success:function(e){1==e.ret?setTimeout(function(){o.removeAttribute("data-kt-indicator"),o.disabled=!1,$(location).attr("href","/user/order/"+e.order_id)},1500):(getResult(e.msg,"","error"),o.removeAttribute("data-kt-indicator"),o.disabled=!1)}})},2e3);break;case"add_credit_order":setTimeout(function(){$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{add_credit_amount:$("#add_credit_amount").val()},success:function(e){1==e.ret?setTimeout(function(){o.removeAttribute("data-kt-indicator"),o.disabled=!1,$(location).attr("href","/user/order/"+e.order_id)},1500):(getResult(e.msg,"","error"),o.removeAttribute("data-kt-indicator"),o.disabled=!1)}})},2e3)}}function KTUsersPayOrder(e){let t=document.querySelector('[data-kt-users-action="submit"]');t.setAttribute("data-kt-indicator","on"),t.disabled=!0,setTimeout(function(){$.ajax({type:"POST",url:"/user/order/pay_order",dataType:"json",data:{method:$("#payment_method a.active").attr("data-name"),order_no:e},success:function(e){1==e.ret?setTimeout(function(){$(location).attr("href",e.url),t.removeAttribute("data-kt-indicator"),t.disabled=!1},1500):2==e.ret?(Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}),t.removeAttribute("data-kt-indicator"),t.disabled=!1):(getResult(e.msg,"","error"),t.removeAttribute("data-kt-indicator"),t.disabled=!1)}})},2e3)}function KTUsersTicket(e,t,o){let n=document.querySelector('[data-kt-users-action="submit"]');n.setAttribute("data-kt-indicator","on"),n.disabled=!0;var r=editors.getData();switch(e){case"create_ticket":setTimeout(function(){$.ajax({type:"POST",url:"/user/ticket",dataType:"json",data:{title:$("#zero_create_ticket_title").val(),content:r},success:function(e){1==e.ret?setTimeout(function(){$(location).attr("href","/user/ticket/"+e.tid+"/view"),n.removeAttribute("data-kt-indicator"),n.disabled=!1},1500):(getResult(e.msg,"","error"),n.removeAttribute("data-kt-indicator"),n.disabled=!1)}})},2e3);break;case"reply_ticket":setTimeout(function(){$.ajax({type:"PUT",url:"/user/ticket/"+t,dataType:"json",data:{status:o,content:r},success:function(e){1==e.ret?setTimeout(function(){location.reload(),n.removeAttribute("data-kt-indicator"),n.disabled=!1},1500):(getResult(e.msg,"","error"),n.removeAttribute("data-kt-indicator"),n.disabled=!1)}})},2e3)}}function KTUsersShowNodeInfo(e,t,o){nodeid=e,(usersclass=t)>=(nodesclass=o)?$.ajax({type:"GET",url:"/user/nodeinfo/"+nodeid,dataType:"json",data:{},success:function(e){if(1==e.ret){if(11==e.sort){var t=e.url;document.getElementById("zero_modal_vmess_node_info_remark").innerHTML=e.info.remark,document.getElementById("zero_modal_vmess_node_info_add").innerHTML=e.info.add,document.getElementById("zero_modal_vmess_node_info_port").innerHTML=e.info.port,document.getElementById("zero_modal_vmess_node_info_aid").innerHTML=e.info.aid,document.getElementById("zero_modal_vmess_node_info_id").innerHTML=e.info.id,document.getElementById("zero_modal_vmess_node_info_net").innerHTML=e.info.net,document.getElementById("zero_modal_vmess_node_info_path").innerHTML=e.info.path,document.getElementById("zero_modal_vmess_node_info_servicename").innerHTML=e.info.servicename,document.getElementById("zero_modal_vmess_node_info_type").innerHTML=e.info.type,document.getElementById("zero_modal_vmess_node_info_security").innerHTML=e.info.tls,document.getElementById("zero_modal_vmess_node_info_qrcode").innerHTML='<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>',$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#nodeinfo-v2ray-modal").modal("show")}else if(14==e.sort){var t=e.url;document.getElementById("zero_modal_trojan_node_info_remark").innerHTML=e.info.remark,document.getElementById("zero_modal_trojan_node_info_add").innerHTML=e.info.address,document.getElementById("zero_modal_trojan_node_info_port").innerHTML=e.info.port,document.getElementById("zero_modal_trojan_node_info_id").innerHTML=e.info.passwd,document.getElementById("zero_modal_trojan_node_info_host").innerHTML=e.info.host,document.getElementById("zero_modal_trojan_node_info_security").innerHTML=e.info.tls,document.getElementById("zero_modal_trojan_node_info_qrcode").innerHTML='<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>',$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#nodeinfo-trojan-modal").modal("show")}else if(15==e.sort){var t=e.url;document.getElementById("zero_modal_vless_node_info_remark").innerHTML=e.info.remark,document.getElementById("zero_modal_vless_node_info_add").innerHTML=e.info.add,document.getElementById("zero_modal_vless_node_info_port").innerHTML=e.info.port,document.getElementById("zero_modal_vless_node_info_id").innerHTML=e.info.id,document.getElementById("zero_modal_vless_node_info_net").innerHTML=e.info.net,document.getElementById("zero_modal_vless_node_info_path").innerHTML=e.info.path,document.getElementById("zero_modal_vless_node_info_type").innerHTML=e.info.type,document.getElementById("zero_modal_vless_node_info_security").innerHTML=e.info.tls,document.getElementById("zero_modal_vless_node_info_flow").innerHTML=e.info.flow,document.getElementById("zero_modal_vless_node_info_sni").innerHTML=e.info.sni,document.getElementById("zero_modal_vless_node_info_qrcode").innerHTML='<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>',$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#nodeinfo-vless-modal").modal("show")}else if(0==e.sort){var t=e.url;document.getElementById("zero_modal_shadowsocks_node_info_remark").innerHTML=e.info.remark,document.getElementById("zero_modal_shadowsocks_node_info_address").innerHTML=e.info.address,document.getElementById("zero_modal_shadowsocks_node_info_port").innerHTML=e.info.port,document.getElementById("zero_modal_shadowsocks_node_info_method").innerHTML=e.info.method,document.getElementById("zero_modal_shadowsocks_node_info_passwd").innerHTML=e.info.passwd,document.getElementById("zero_modal_shadowsocks_node_info_qrcode").innerHTML='<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>',$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#nodeinfo-ss-modal").modal("show")}}else getResult(e.msg,"","error")}}):getResult("会员身份权限不足","","error")}KTUtil.onDOMContentLoaded(function(){KTUsersUpdatePassword.init()});