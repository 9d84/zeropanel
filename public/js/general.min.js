var clipboard=new ClipboardJS(".copy-text");function getResult(e,t,o){Swal.fire({title:e,text:t,icon:o,buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-primary"}})}function getLoad(){Swal.fire({title:"",text:"",timer:5e4,confirmButtonText:"",didOpen:function(){Swal.showLoading()}}).then(function(e){"timer"==e.dismiss&&console.log("I was closed by the timer")})}clipboard.on("success",function(e){getResult("复制成功","","success")}),$(document).ready(function(){$("a.menu-link[href='"+window.location.pathname+"']").addClass("active")});var KTUsersUpdateEmail=function(){let e=document.getElementById("zero_modal_user_update_email"),t=e.querySelector("#zero_modal_user_update_email_form");new bootstrap.Modal(e);var o=()=>{var o=FormValidation.formValidation(t,{fields:{profile_email:{validators:{notEmpty:{message:"Email address is required"},emailAddress:{message:"邮箱格式不正确"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let r=e.querySelector('[data-kt-users-modal-action="submit"]');r.addEventListener("click",function(e){e.preventDefault(),o&&o.validate().then(function(e){console.log("validated!"),"Valid"==e&&(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,setTimeout(function(){$.ajax({type:"POST",url:"/user/update_profile/email",dataType:"json",data:{newemail:$("#profile_email").val()},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3))})})};return{init:function(){o()}}}();KTUtil.onDOMContentLoaded(function(){KTUsersUpdateEmail.init()});var KTUsersUpdatePassword=function(){let e=document.getElementById("zero_modal_user_update_password"),t=e.querySelector("#zero_modal_user_update_password_form"),o=new bootstrap.Modal(e);var r=()=>{var r=FormValidation.formValidation(t,{fields:{current_password:{validators:{notEmpty:{message:"请输入当前密码"}}},password:{validators:{notEmpty:{message:"请输入新密码"},callback:{message:"请输入有效的密码",callback:function(e){if(e.value.length>0)return validatePassword()}}}},confirm_password:{validators:{notEmpty:{message:"请确认新密码"},identical:{compare:function(){return t.querySelector('[name="new_password"]').value},message:"新密码两次输入不一致"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let a=e.querySelector('[data-kt-users-modal-action="submit"]');a.addEventListener("click",function(e){e.preventDefault(),r&&r.validate().then(function(e){console.log("validated!"),"Valid"==e&&(a.setAttribute("data-kt-indicator","on"),a.disabled=!0,setTimeout(function(){$.ajax({type:"POST",url:"/user/update_profile/password",dataType:"json",data:{current_password:$("#current_password").val(),new_password:$("#new_password").val()},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&(o.hide(),location.reload())}):(getResult(e.msg,"","error"),a.removeAttribute("data-kt-indicator"),a.disabled=!1)}})},2e3))})})};return{init:function(){r()}}}();function KTUsersEnableNotify(e){if(document.getElementById("notify_email").checked)var t=e;else if(document.getElementById("notify_telegram").checked)var t=e;$.ajax({type:"POST",url:"/user/enable_notify",dataType:"json",data:{notify_type:t},success:function(e){}})}function KTUsersResetPasswd(){$.ajax({type:"POST",url:"/user/update_profile/passwd",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function KTUsersResetUUID(){$.ajax({type:"POST",url:"/user/update_profile/uuid",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function KTUsersResetSubLink(){$.ajax({type:"POST",url:"/user/update_profile/sub_token",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function kTUserConfigureProductModal(e,t){the_product_id=e;let o=$("#zero_product_"+e).html(),r=$("#zero_product_name_"+e).html(),a=$("#zero_product_price_"+e).html(),n=$("#zero_product_price_"+e).attr("data-price-quarter"),s=$("#zero_product_price_"+e).attr("data-price-half-year"),i=$("#zero_product_price_"+e).attr("data-price-year"),d=document.querySelector('[data-kt-users-action="submit"]');a&&($("#zero_modal_configure_product_month_price").html('<a class="btn btn-outline btn-active-light-primary active" data-bs-toggle="pill">月付</a>'),$("#zero_modal_configure_product_month_price").attr("onclick",'KTUsersChangePlan("'+a+'", '+e+', "month", "'+t+'")')),n&&($("#zero_modal_configure_product_quarter_price").html('<a class="btn btn-outline btn-active-light-primary" data-bs-toggle="pill">季付</a>'),$("#zero_modal_configure_product_quarter_price").attr("onclick",'KTUsersChangePlan("'+n+'", '+e+', "quarter", "'+t+'")')),s&&($("#zero_modal_configure_product_half_year_price").html('<a class="btn btn-outline btn-active-light-primary" data-bs-toggle="pill">半年付</a>'),$("#zero_modal_configure_product_half_year_price").attr("onclick",'KTUsersChangePlan("'+s+'", '+e+', "half_year", "'+t+'")')),i&&($("#zero_modal_configure_product_year_price").html('<a class="btn btn-outline btn-active-light-primary" data-bs-toggle="pill">年付</a>'),$("#zero_modal_configure_product_year_price").attr("onclick",'KTUsersChangePlan("'+i+'", '+e+', "year", "'+t+'")')),$("#zero_modal_configure_product_inner_html").html(o),$("#zero_modal_configure_product_name").html(r+"&nbsp;X&nbsp;月付"),$("#zero_modal_configure_product_price").html(a+t),$("#zero_modal_configure_product_total").html(a+t),d.setAttribute("onclick",'KTUsersCreateOrder(1, "'+a+'", '+e+")"),$("#zero_modal_configure_product").modal("show")}function KTUsersChangePlan(e,t,o,r){switch(o){case"month":plan="月付";break;case"quarter":plan="季付";break;case"half_year":plan="半年付";break;case"year":plan="年付"}let a=$("#zero_product_name_"+t).html(),n=document.querySelector('[data-kt-users-action="submit"]');$("#zero_modal_configure_product_name").html(a+"&nbsp;X&nbsp;"+plan),$("#zero_modal_configure_product_price").html(e+r),$("#zero_modal_configure_product_total").html(e+r),n.setAttribute("onclick",'KTUsersCreateOrder(1, "'+e+'", '+t+")")}function KTUserVerifyCoupon(){$.ajax({type:"POST",url:"/user/verify_coupon",dataType:"json",data:{coupon_code:$("#zero_coupon_code").val(),product_id:the_product_id},success:function(e){1==e.ret?document.getElementById("zero_modal_configure_product_total").innerHTML=e.total+"USD":getResult(e.msg,"","error")}})}function KTUsersCreateOrder(e,t,o){let r=document.querySelector('[data-kt-users-action="submit"]');switch(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,e){case 1:setTimeout(function(){$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{product_id:o,product_price:t,coupon_code:$("#zero_coupon_code").val()},success:function(e){1==e.ret?setTimeout(function(){$(location).attr("href","/user/order/"+e.order_id)},1500):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3);break;case 2:setTimeout(function(){$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{add_credit_amount:$("#add_credit_amount").val()},success:function(e){1==e.ret?setTimeout(function(){$(location).attr("href","/user/order/"+e.order_id)},1500):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3)}}function KTUsersPayOrder(e){let t=document.querySelector('[data-kt-users-action="submit"]');t.setAttribute("data-kt-indicator","on"),t.disabled=!0,setTimeout(function(){$.ajax({type:"POST",url:"/user/order/pay_order",dataType:"json",data:{method:$("#payment_method a.active").attr("data-name"),order_no:e},success:function(e){1==e.ret?setTimeout(function(){$(location).attr("href",e.url)},1500):2==e.ret?(Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}),t.removeAttribute("data-kt-indicator"),t.disabled=!1):(getResult(e.msg,"","error"),t.removeAttribute("data-kt-indicator"),t.disabled=!1)}})},2e3)}function KTUsersTicket(e,t,o){let r=document.querySelector('[data-kt-users-action="submit"]');r.setAttribute("data-kt-indicator","on"),r.disabled=!0;var a=editors.getData();switch(e){case"create_ticket":setTimeout(function(){$.ajax({type:"POST",url:"/user/ticket",dataType:"json",data:{title:$("#zero_create_ticket_title").val(),content:a},success:function(e){1==e.ret?setTimeout(function(){$(location).attr("href","/user/ticket/view/"+e.id)},1500):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3);break;case"reply_ticket":setTimeout(function(){$.ajax({type:"PUT",url:"/user/ticket/"+t,dataType:"json",data:{status:o,content:a},success:function(e){1==e.ret?setTimeout(function(){location.reload()},1500):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3)}}function KTUsersShowNodeInfo(e,t,o){nodeid=e,(usersclass=t)>=(nodesclass=o)?(getLoad(),$.ajax({type:"GET",url:"/user/nodeinfo/"+nodeid,dataType:"json",data:{},success:function(e){if(1==e.ret){var t=e.url;switch(e.sort){case 11:$("#zero_modal_vmess_node_info_remark").html(e.info.remark),$("#zero_modal_vmess_node_info_add").html(e.info.add),$("#zero_modal_vmess_node_info_port").html(e.info.port),$("#zero_modal_vmess_node_info_aid").html(e.info.aid),$("#zero_modal_vmess_node_info_id").html(e.info.id),$("#zero_modal_vmess_node_info_net").html(e.info.net),$("#zero_modal_vmess_node_info_path").html(e.info.path),$("#zero_modal_vmess_node_info_host").html(e.info.host),$("#zero_modal_vmess_node_info_servicename").html(e.info.servicename),$("#zero_modal_vmess_node_info_type").html(e.info.type),$("#zero_modal_vmess_node_info_security").html(e.info.tls),$("#zero_modal_vmess_node_info_qrcode").html('<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>'),$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#zero_modal_vmess_node_info").modal("show");break;case 14:$("#zero_modal_trojan_node_info_remark").html(e.info.remark),$("#zero_modal_trojan_node_info_add").html(e.info.address),$("#zero_modal_trojan_node_info_port").html(e.info.port),$("#zero_modal_trojan_node_info_id").html(e.info.passwd),$("#zero_modal_trojan_node_info_host").html(e.info.host),$("#zero_modal_trojan_node_info_security").html(e.info.tls),$("#zero_modal_trojan_node_info_qrcode").html('<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>'),$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#nodeinfo-trojan-modal").modal("show");break;case 15:$("#zero_modal_vless_node_info_remark").html(e.info.remark),$("#zero_modal_vless_node_info_add").html(e.info.add),$("#zero_modal_vless_node_info_port").html(e.info.port),$("#zero_modal_vless_node_info_id").html(e.info.id),$("#zero_modal_vless_node_info_net").html(e.info.net),$("#zero_modal_vless_node_info_path").html(e.info.path),$("#zero_modal_vless_node_info_host").html(e.info.host),$("#zero_modal_vless_node_info_servicename").html(e.info.servicename),$("#zero_modal_vless_node_info_type").html(e.info.type),$("#zero_modal_vless_node_info_security").html(e.info.tls),$("#zero_modal_vless_node_info_flow").html(e.info.flow),$("#zero_modal_vless_node_info_sni").html(e.info.sni),$("#zero_modal_vless_node_info_qrcode").html('<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>'),$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#nodeinfo-vless-modal").modal("show");break;case 0:$("#zero_modal_shadowsocks_node_info_remark").html(e.info.remark),$("#zero_modal_shadowsocks_node_info_address").html(e.info.address),$("#zero_modal_shadowsocks_node_info_port").html(e.info.port),$("#zero_modal_shadowsocks_node_info_method").html(e.info.method),$("#zero_modal_shadowsocks_node_info_passwd").html(e.info.passwd),$("#zero_modal_shadowsocks_node_info_qrcode").html('<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>'),$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:t}),Swal.close(),$("#zero_modal_shadowsocks_node_info").modal("show")}}else getResult(e.msg,"","error")}})):getResult("权限不足","","error")}function KTUsersWithdrawCommission(e){switch(e){case 1:$.ajax({type:"POST",url:"/user/withdraw_commission",dataType:"json",data:{commission:$("#withdraw_commission_amount").val(),type:$("#withdraw_type a.active").attr("data-type")},success:function(e){1==e.ret?getResult(e.msg,"","success"):getResult(e.msg,"","error")}});break;case 2:$.ajax({type:"POST",url:"/user/withdraw_account_setting",dataType:"json",data:{acc:$("#withdraw_account_value").val(),method:$("#withdraw_method").val()},success:function(e){1==e.ret?getResult(e.msg,"","success"):getResult(e.msg,"","error")}})}}function oneclickImport(e,t){var o={surfboard:"surfboard:///install-config?url="+encodeURIComponent(t),quantumult:"quantumult://configuration?server="+btoa(t).replace(/=/g,"")+"&filter=YUhSMGNITTZMeTl0ZVM1dmMyOWxZMjh1ZUhsNkwzSjFiR1Z6TDNGMVlXNTBkVzExYkhRdVkyOXVaZw",shadowrocket:"shadowrocket://add/sub://"+btoa(t),surge4:"surge4:///install-config?url="+encodeURIComponent(t),clash:"clash://install-config?url="+encodeURIComponent(t),sagernet:"sn://subscription?url="+encodeURIComponent(t)};Swal.fire({title:"Whether to import subscription links",icon:"warning",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Discard",focusClose:!1,focusConfirm:!1}).then(t=>{t.value&&(window.location.href=o[e])})}KTUtil.onDOMContentLoaded(function(){KTUsersUpdatePassword.init()});