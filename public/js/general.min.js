var clipboard=new ClipboardJS(".copy-text");function getResult(e,t,o){Swal.fire({title:e,text:t,icon:o,buttonsStyling:!1,confirmButtonText:"OK",customClass:{confirmButton:"btn btn-primary"}})}function getLoad(){Swal.fire({title:"",text:"",timer:5e4,confirmButtonText:"",didOpen:function(){Swal.showLoading()}}).then(function(e){"timer"==e.dismiss&&console.log("I was closed by the timer")})}clipboard.on("success",function(e){getResult("复制成功","","success")}),$(document).ready(function(){$("a.menu-link[href='"+window.location.pathname+"']").addClass("active")});var KTUsersUpdateEmail=function(){let e=document.getElementById("zero_modal_user_update_email"),t=e.querySelector("#zero_modal_user_update_email_form");new bootstrap.Modal(e);var o=()=>{var o=FormValidation.formValidation(t,{fields:{profile_email:{validators:{notEmpty:{message:"Email address is required"},emailAddress:{message:"邮箱格式不正确"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let r=e.querySelector('[data-kt-users-modal-action="submit"]');r.addEventListener("click",function(e){e.preventDefault(),o&&o.validate().then(function(e){console.log("validated!"),"Valid"==e&&(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,setTimeout(function(){$.ajax({type:"POST",url:"/user/update_profile/email",dataType:"json",data:{newemail:$("#profile_email").val()},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3))})})};return{init:function(){o()}}}();KTUtil.onDOMContentLoaded(function(){KTUsersUpdateEmail.init()});var KTUsersUpdatePassword=function(){let e=document.getElementById("zero_modal_user_update_password"),t=e.querySelector("#zero_modal_user_update_password_form"),o=new bootstrap.Modal(e);var r=()=>{var r=FormValidation.formValidation(t,{fields:{current_password:{validators:{notEmpty:{message:"请输入当前密码"}}},password:{validators:{notEmpty:{message:"请输入新密码"},callback:{message:"请输入有效的密码",callback:function(e){if(e.value.length>0)return validatePassword()}}}},confirm_password:{validators:{notEmpty:{message:"请确认新密码"},identical:{compare:function(){return t.querySelector('[name="new_password"]').value},message:"新密码两次输入不一致"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});let a=e.querySelector('[data-kt-users-modal-action="submit"]');a.addEventListener("click",function(e){e.preventDefault(),r&&r.validate().then(function(e){console.log("validated!"),"Valid"==e&&(a.setAttribute("data-kt-indicator","on"),a.disabled=!0,setTimeout(function(){$.ajax({type:"POST",url:"/user/update_profile/password",dataType:"json",data:{current_password:$("#current_password").val(),new_password:$("#new_password").val()},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&(o.hide(),location.reload())}):(getResult(e.msg,"","error"),a.removeAttribute("data-kt-indicator"),a.disabled=!1)}})},2e3))})})};return{init:function(){r()}}}();function KTUsersEnableNotify(e){if(document.getElementById("notify_email").checked)var t=e;else if(document.getElementById("notify_telegram").checked)var t=e;$.ajax({type:"POST",url:"/user/enable_notify",dataType:"json",data:{notify_type:t},success:function(e){}})}function KTUsersResetPasswd(){$.ajax({type:"POST",url:"/user/update_profile/passwd",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function KTUsersResetUUID(){$.ajax({type:"POST",url:"/user/update_profile/uuid",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function KTUsersResetSubLink(){$.ajax({type:"POST",url:"/user/update_profile/sub_token",dataType:"json",data:{},success:function(e){1===e.ret?Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}):getResult(e.msg,"","error")}})}function kTUserConfigureProductModal(e,t){new Promise(function(t,o){$.ajax({type:"POST",url:"/user/product/getinfo",dataType:"json",data:{id:e},success:function(e){t(e)}})}).then(function(o){let r=o,a=$("#zero_product_"+e).html(),n=r.name,s=r.month_price,i=r.quarter_price,d=r.half_year_price,l=r.year_price,c=document.querySelector('[data-kt-users-action="submit"]');1==r.type&&Object.entries({month_price:{label:"月付",value:s},quarter_price:{label:"季付",value:i},half_year_price:{label:"半年付",value:d},year_price:{label:"年付",value:l}}).forEach(([o,{label:r,value:a}])=>{a&&($("#zero_modal_configure_product_"+o).html(`<a class="btn btn-outline btn-active-light-primary" data-bs-toggle="pill">${r}</a>`),$("#zero_modal_configure_product_"+o).attr("onclick",`KTUsersChangePlan("${a}", ${e}, "${o}", "${t}")`),"month_price"===o&&$("#zero_modal_configure_product_"+o+" a").addClass("active"))});var u=$("#zero_modal_configure_product_inner_html"),m=$("#zero_modal_configure_product_name"),f=$("#zero_modal_configure_product_price"),p=$("#zero_modal_configure_product_total"),g=$("#zero_modal_configure_coupon"),h=$("#zero_modal_configure_coupon_html");u.html(a),3==r.type&&h.hide(),m.html(1==r.type?n+"&nbsp;X&nbsp;月付":n),f.html(s+t),p.html(s+t),g.attr("onclick","KTUserVerifyCoupon("+e+")"),c.setAttribute("onclick",'KTUsersCreateOrder(1, "'+s+'", '+e+")"),$("#zero_modal_configure_product").modal("show")})}function KTUsersChangePlan(e,t,o,r){let a=$("#zero_product_name_"+t).html(),n=document.querySelector('[data-kt-users-action="submit"]');$("#zero_modal_configure_product_name").html(`${a} X ${{month_price:"月付",quarter_price:"季付",half_year_price:"半年付",year_price:"年付"}[o]}`),$("#zero_modal_configure_product_price").html(`${e}${r}`),$("#zero_modal_configure_product_total").html(`${e}${r}`),n.setAttribute("onclick",'KTUsersCreateOrder(1, "'+e+'", '+t+")")}function KTUserVerifyCoupon(e){$.ajax({type:"POST",url:"/user/verify_coupon",dataType:"json",data:{coupon_code:$("#zero_coupon_code").val(),product_id:e},success:function(e){1==e.ret?document.getElementById("zero_modal_configure_product_total").innerHTML=e.total+"USD":getResult(e.msg,"","error")}})}function KTUsersCreateOrder(e,t,o){let r=document.querySelector('[data-kt-users-action="submit"]');switch(r.setAttribute("data-kt-indicator","on"),r.disabled=!0,e){case 1:setTimeout(function(){$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{product_id:o,product_price:t,coupon_code:$("#zero_coupon_code").val()},success:function(e){1==e.ret?$(location).attr("href","/user/order/"+e.order_id):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3);break;case 2:setTimeout(function(){$.ajax({type:"POST",url:"/user/order/create_order/"+e,dataType:"json",data:{add_credit_amount:$("#add_credit_amount").val()},success:function(e){1==e.ret?$(location).attr("href","/user/order/"+e.order_id):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3)}}function KTUsersPayOrder(e){let t=document.querySelector('[data-kt-users-action="submit"]');t.setAttribute("data-kt-indicator","on"),t.disabled=!0;let o=$("#payment_method a.active").attr("data-name"),r=e;setTimeout(()=>{$.ajax({type:"POST",url:"/user/order/pay_order",dataType:"json",data:{method:o,order_no:r},success:function(e){1==e.ret?$(location).attr("href",e.url):2==e.ret?(Swal.fire({text:e.msg,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(function(e){e.isConfirmed&&location.reload()}),t.removeAttribute("data-kt-indicator"),t.disabled=!1):(getResult(e.msg,"","error"),t.removeAttribute("data-kt-indicator"),t.disabled=!1)}})},2e3)}function KTUsersTicket(e,t,o){let r=document.querySelector('[data-kt-users-action="submit"]');r.setAttribute("data-kt-indicator","on"),r.disabled=!0;var a=editors.getData();switch(e){case"create_ticket":setTimeout(function(){$.ajax({type:"POST",url:"/user/ticket/create",dataType:"json",data:{title:$("#zero_create_ticket_title").val(),comment:a,type:$("#zero_create_ticket_type").val()},success:function(e){1==e.ret?$(location).attr("href","/user/ticket/view/"+e.id):(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3);break;case"reply_ticket":setTimeout(function(){$.ajax({type:"PUT",url:"/user/ticket/update",dataType:"json",data:{id:t,status:o,comment:a},success:function(e){1==e.ret?location.reload():(getResult(e.msg,"","error"),r.removeAttribute("data-kt-indicator"),r.disabled=!1)}})},2e3)}}function KTUsersShowNodeInfo(e,t,o){nodeid=e,(usersclass=t)>=(nodesclass=o)?(getLoad(),$.ajax({type:"GET",url:"/user/nodeinfo/"+nodeid,dataType:"json",data:{},success:function(e){if(1==e.ret){let t=e.info,o='<div class="pb-3" align="center" id="qrcode'+nodeid+'"></div>';var r=e.url;switch(e.sort){case 11:let a={"#zero_modal_vmess_node_info_remark":"remark","#zero_modal_vmess_node_info_address":"address","#zero_modal_vmess_node_info_port":"port","#zero_modal_vmess_node_info_aid":"aid","#zero_modal_vmess_node_info_uuid":"uuid","#zero_modal_vmess_node_info_net":"net","#zero_modal_vmess_node_info_path":"path","#zero_modal_vmess_node_info_host":"host","#zero_modal_vmess_node_info_servicename":"servicename","#zero_modal_vmess_node_info_type":"type","#zero_modal_vmess_node_info_security":"security"};for(let n in a)$(n).html(t[a[n]]);$("#zero_modal_vmess_node_info_qrcode").html(o),$("#zero_modal_vmess_node_info").modal("show");break;case 14:let s={"#zero_modal_trojan_node_info_remark":"remark","#zero_modal_trojan_node_info_address":"address","#zero_modal_trojan_node_info_port":"port","#zero_modal_trojan_node_info_uuid":"uuid","#zero_modal_trojan_node_info_sni":"sni","#zero_modal_trojan_node_info_security":"security","#zero_modal_trojan_node_info_flow":"flow"};for(let i in s)$(i).html(t[s[i]]);$("#zero_modal_trojan_node_info_qrcode").html(o),$("#zero_modal_trojan_node_info").modal("show");break;case 15:let d={"#zero_modal_vless_node_info_remark":"remark","#zero_modal_vless_node_info_address":"address","#zero_modal_vless_node_info_port":"port","#zero_modal_vless_node_info_uuid":"uuid","#zero_modal_vless_node_info_net":"net","#zero_modal_vless_node_info_path":"path","#zero_modal_vless_node_info_host":"host","#zero_modal_vless_node_info_servicename":"servicename","#zero_modal_vless_node_info_type":"type","#zero_modal_vless_node_info_security":"security","#zero_modal_vless_node_info_flow":"flow","#zero_modal_vless_node_info_sni":"sni"};for(let l in d)$(l).html(t[d[l]]);$("#zero_modal_vless_node_info_qrcode").html(o),$("#zero_modal_vless_node_info").modal("show");break;case 0:let c={"#zero_modal_shadowsocks_node_info_remark":"remark","#zero_modal_shadowsocks_node_info_address":"address","#zero_modal_shadowsocks_node_info_port":"port","#zero_modal_shadowsocks_node_info_method":"method","#zero_modal_shadowsocks_node_info_passwd":"passwd"};for(let u in c)$(u).html(t[c[u]]);$("#zero_modal_shadowsocks_node_info_qrcode").html(o),$("#zero_modal_shadowsocks_node_info").modal("show")}$("#qrcode"+nodeid).qrcode({width:200,height:200,render:"canvas",text:r}),Swal.close()}else getResult(e.msg,"","error")}})):getResult("权限不足","","error")}function KTUsersWithdrawCommission(e){switch(e){case 1:$.post("/user/withdraw_commission",{commission:$("#withdraw_commission_amount").val(),type:$("#withdraw_type a.active").attr("data-type")},function(e){getResult(e.msg,"",1==e.ret?"success":"error")},"json");break;case 2:$.post("/user/withdraw_account_setting",{acc:$("#withdraw_account_value").val(),method:$("#withdraw_method").val()},function(e){getResult(e.msg,"",1==e.ret?"success":"error")},"json")}}function oneclickImport(e,t){var o={surfboard:"surfboard:///install-config?url="+encodeURIComponent(t),quantumult:"quantumult://configuration?server="+btoa(t).replace(/=/g,"")+"&filter=YUhSMGNITTZMeTl0ZVM1dmMyOWxZMjh1ZUhsNkwzSjFiR1Z6TDNGMVlXNTBkVzExYkhRdVkyOXVaZw",shadowrocket:"shadowrocket://add/sub://"+btoa(t),surge4:"surge4:///install-config?url="+encodeURIComponent(t),clash:"clash://install-config?url="+encodeURIComponent(t),sagernet:"sn://subscription?url="+encodeURIComponent(t)};Swal.fire({title:"Whether to import subscription links",icon:"warning",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Discard",focusClose:!1,focusConfirm:!1}).then(t=>{t.value&&(window.location.href=o[e])})}KTUtil.onDOMContentLoaded(function(){KTUsersUpdatePassword.init()});